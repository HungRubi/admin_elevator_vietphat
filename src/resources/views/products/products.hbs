<div class="heading_page">
    <h5>Dashboard <i class="bi bi-chevron-right"></i> Products</h5>
    <h2>Products</h2>
    <div class="option_table is-between">
      <div class="is-between search_right">
        <div class="add_btn btn btn-primary btn_me">
            <a href="/products/add">
                <i class="bi bi-plus-lg"></i> Add product
            </a>
        </div>
        <div class="export_btn">
            <i class="bi bi-file-earmark-arrow-down-fill"></i>
            Export
        </div>
      </div>
    </div>
</div>

<div class="layout comments">
  <div class="title_table is-between">
    <div class="title d-flex align-items-center">
      <h3>Products list <br>
        <span class="sub_heading">List of all products on the website</span>
      </h3>
    </div>
    <div class="search is-center">
      <div class="wrapper_search">
        <form action="/products">
          <button type="submit" class="btn_position is-center"><i class="bi bi-search"></i></button>
          <input type="text" name="timkiem" placeholder="Enter product name to search">
        </form>
      </div>
      <div class="seleted">All products</div>
      <div class="selection">
          <i class="bi bi-three-dots"></i>
      </div>
    </div>
  </div>
  <table class="table table_convert">
      <thead>
        <tr>
          <th scope="col" class="column_checkbox"><input type="checkbox" name="" id=""></th>
          <th scope="col" class="col_image"></th>
          <th scope="col align-middle">
            Product
            <a href="?sort=name&order={{#if (and (eq currentSort 'name') (eq currentOrder 'asc'))}}desc{{else}}asc{{/if}}">
                <i class="bi {{#if (eq currentSort 'name')}}{{#if (eq currentOrder 'asc')}}bi-caret-up-fill{{else}}bi-caret-down-fill{{/if}}{{else}}bi-chevron-expand{{/if}}" 
                  style="font-size:12px; color:#000;">
                </i>
            </a>
          </th>
          <th scope="col">
            Price 
            <a href="?sort=price&order={{#if (and (eq currentSort 'price') (eq currentOrder 'asc'))}}desc{{else}}asc{{/if}}">
                <i class="bi {{#if (eq currentSort 'price')}}{{#if (eq currentOrder 'asc')}}bi-caret-up-fill{{else}}bi-caret-down-fill{{/if}}{{else}}bi-chevron-expand{{/if}}" 
                  style="font-size:12px; color:#000;">
                </i>
            </a>
          </th>
          <th scope="col" style="padding-left:40px" class="col_status">
            Stock 
            <a href="?sort=stock&order={{#if (and (eq currentSort 'stock') (eq currentOrder 'asc'))}}desc{{else}}asc{{/if}}">
              <i class="bi {{#if (eq currentSort 'stock')}}{{#if (eq currentOrder 'asc')}}bi-caret-up-fill{{else}}bi-caret-down-fill{{/if}}{{else}}bi-chevron-expand{{/if}}" 
                style="font-size:12px; color:#000;">
              </i>
            </a>
          </th>
          <th scope="col">
            Unit
            <a href="?sort=unit&order={{#if (and (eq currentSort 'unit') (eq currentOrder 'asc'))}}desc{{else}}asc{{/if}}">
              <i class="bi {{#if (eq currentSort 'unit')}}{{#if (eq currentOrder 'asc')}}bi-caret-up-fill{{else}}bi-caret-down-fill{{/if}}{{else}}bi-chevron-expand{{/if}}" 
                style="font-size:12px; color:#000;">
              </i>
            </a>
          </th>
          <th scope="col">Description</th>
          <th scope="col" class="col_time">
            Time 
            <a href="?sort=updatedAt&order={{#if (and (eq currentSort 'updatedAt') (eq currentOrder 'asc'))}}desc{{else}}asc{{/if}}">
              <i class="bi {{#if (eq currentSort 'updatedAt')}}{{#if (eq currentOrder 'asc')}}bi-caret-up-fill{{else}}bi-caret-down-fill{{/if}}{{else}}bi-chevron-expand{{/if}}" 
                style="font-size:12px; color:#000;">
              </i>
            </a>
          </th>
        </tr>
      </thead>
      <tbody id="table_body">
        {{#if searchProduct}}
          {{#each searchProduct}}
            <tr class="align-middle">
                <td class="column_checkbox"><input type="checkbox" name="" id=""></th>
                <td class="col_image text-center">
                    <div class="wrapper_img_product is-center">
                        <a href="#" class="is-center" style="width:100%;">
                            <img src="{{this.thumbnail_main}}" alt="">
                        </a>
                    </div>
                </td>
                <td style="color: rgb(56, 116, 255);" class="col_product"><span>{{this.name}}</span></td>
                <td class="col_custumer col-1">{{this.price}}</td>
                <td class="col_status col-1" style="padding-left:40px">{{this.stock}}</td>
                <td class="col_star col-1">{{this.unit}}</td>
                <td class="col_review col-4"><p>{{this.description}}</p></td>
                <td class="col_time">
                    <p>{{this.lastUpdate}}</p>
                    <div class="layout">
                        <div class="circle">
                            <a href="/products/{{this._id}}/edit">
                                <i class="bi bi-pencil-fill"></i>
                            </a>
                        </div>
                        <div class="circle">
                            <a href="/products/{{this._id}}/deleted" data-bs-toggle="modal" data-id="{{this._id}}" data-bs-target="#delete-product-model">
                                <i class="bi bi-trash"></i>
                            </a>
                        </div>
                        <div class="circle"><i class="bi bi-three-dots"></i></div>
                    </div>
                </td>
            </tr>
          {{/each}}
        {{else}}
          {{#each formatProducts}}
            <tr class="align-middle">
                <td class="column_checkbox"><input type="checkbox" name="" id=""></th>
                <td class="col_image text-center">
                    <div class="wrapper_img_product is-center">
                        <a href="#" class="is-center" style="width:100%;">
                            <img src="{{this.thumbnail_main}}" alt="">
                        </a>
                    </div>
                </td>
                <td style="color: rgb(56, 116, 255);" class="col_product"><span>{{this.name}}</span></td>
                <td class="col_custumer col-1">{{this.price}}</td>
                <td class="col_status col-1" style="padding-left:40px">{{this.stock}}</td>
                <td class="col_star col-1">{{this.unit}}</td>
                <td class="col_review col-4"><p>{{this.description}}</p></td>
                <td class="col_time">
                    <p>{{this.dateFormat}}</p>
                    <div class="layout">
                        <div class="circle">
                            <a href="/products/{{this._id}}/edit">
                                <i class="bi bi-pencil-fill"></i>
                            </a>
                        </div>
                        <div class="circle">
                            <a href="/products/{{this._id}}/deleted" data-bs-toggle="modal" data-id="{{this._id}}" data-bs-target="#delete-product-model">
                                <i class="bi bi-trash"></i>
                            </a>
                        </div>
                        <div class="circle"><i class="bi bi-three-dots"></i></div>
                    </div>
                </td>
            </tr>
          {{/each}}
        {{/if}}
      </tbody>
  </table>
  <div class="page_bar is-center">
    {{#if (gt currentPage 1)}}
      <button class="next previous">
        <a href="?page={{subtract currentPage 1}}" style="color:#292828;">
            <i class="bi bi-chevron-left"></i>
            Previous
        </a>
      </button>
    {{/if}}
    {{#each (range 1 totalPage)}}
      {{#if (eq this ../currentPage)}}
        <button class="number_page active">
          <a href="?page={{this}}">{{this}}</a>
        </button>
      {{else}}
        <button class="number_page">
          <a style="color:#292828;" href="?page={{this}}">{{this}}</a>
        </button>
      {{/if}}
    {{/each}}
    {{#if (gt currentPage 1)}}
      <button class="next previous">
        <a href="?page={{add currentPage 1}}" style="color:#292828;">
            Next
            <i class="bi bi-chevron-right"></i>
        </a>
      </button>
    {{/if}}
  </div> 
</div>

<form method="POST" name="delete-product-form"></form>

<div class="modal fade" id="delete-product-model" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">Delete product</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body d-flex align-items-center">
        Are you want to delete this product!
        <i class="bi bi-emoji-frown-fill" style="font-size: 1.2rem; color: red; margin-left: 10px;"></i>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" id="btn-delete">Delete</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

<div class="footer">
    Thank you for creating with HuyHung | 2024 Â© 
</div>

<script>
  const deleteSong = document.getElementById('delete-product-model')
  const btnDelete = document.getElementById('btn-delete');
  const deleteForm = document.forms['delete-product-form'];

  var productId;
  if (deleteSong) {
    deleteSong.addEventListener('show.bs.modal', event => {
      const button = event.relatedTarget
      productId = button.getAttribute('data-id')
    })
  }
  if(btnDelete){
    btnDelete.addEventListener('click', () => {
      deleteForm.action = '/products/' + productId + '?_method=DELETE';
      deleteForm.submit();
    })
  }
</script>