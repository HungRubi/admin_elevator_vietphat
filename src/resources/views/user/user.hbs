<div class="heading_page">
    <h5>Dashboard <i class="bi bi-chevron-right"></i> Users</h5>
    <h2>Users</h2>
    <div class="option_table is-between">
        <div class="is-between search_right">
            <div>
                <a href="/users/add" class="btn btn-primary">
                    <i class="bi bi-plus-lg"></i> Add user
                </a>
            </div>
            <div class="export_btn">
                <i class="bi bi-file-earmark-arrow-down-fill"></i>
                Export
            </div>
        </div>
    </div>
</div>

<div class="layout comments">
    <div class="title_table is-between">
        <div class="title">
            <h3>Users list</h3>
            <p class="sub_heading">List of all users on the website</p>
        </div>
        <div class="search is-center">
            <div class="wrapper_search">
                <form action="/users">
                    <button type="submit" class="btn_position is-center"><i class="bi bi-search"></i></button>
                    <input type="text" name="timkiem" placeholder="Enter user name to search">
                </form>
            </div>
            <div class="seleted">All Users</div>
            <div class="selection">
                <i class="bi bi-three-dots"></i>
            </div>
        </div>
    </div>
    <table class="table table_convert">
        <thead>
            <tr>
                <th scope="col" class="column_checkbox"><input type="checkbox" name="" id=""></th>
                <th scope="col" class="col-2 ps-5">
                    Users 
                    <a href="?sort=name&order={{#if (and (eq currentSort 'name') (eq currentOrder 'asc'))}}desc{{else}}asc{{/if}}">
                        <i class="bi {{#if (eq currentSort 'name')}}{{#if (eq currentOrder 'asc')}}bi-caret-up-fill{{else}}bi-caret-down-fill{{/if}}{{else}}bi-chevron-expand{{/if}}" 
                            style="font-size:12px; color:#000;">
                        </i>
                    </a>
                </th>
                <th scope="col">
                    Account 
                    <a href="?sort=account&order={{#if (and (eq currentSort 'account') (eq currentOrder 'asc'))}}desc{{else}}asc{{/if}}">
                        <i class="bi {{#if (eq currentSort 'account')}}{{#if (eq currentOrder 'asc')}}bi-caret-up-fill{{else}}bi-caret-down-fill{{/if}}{{else}}bi-chevron-expand{{/if}}" 
                            style="font-size:12px; color:#000;">
                        </i>
                    </a>
                </th>
                <th scope="col">
                    Email 
                    <a href="?sort=email&order={{#if (and (eq currentSort 'email') (eq currentOrder 'asc'))}}desc{{else}}asc{{/if}}">
                        <i class="bi {{#if (eq currentSort 'email')}}{{#if (eq currentOrder 'asc')}}bi-caret-up-fill{{else}}bi-caret-down-fill{{/if}}{{else}}bi-chevron-expand{{/if}}" 
                            style="font-size:12px; color:#000;">
                        </i>
                    </a>
                </th>
                <th scope="col">
                    Birth 
                    <a href="?sort=birth&order={{#if (and (eq currentSort 'birth') (eq currentOrder 'asc'))}}desc{{else}}asc{{/if}}">
                        <i class="bi {{#if (eq currentSort 'birth')}}{{#if (eq currentOrder 'asc')}}bi-caret-up-fill{{else}}bi-caret-down-fill{{/if}}{{else}}bi-chevron-expand{{/if}}" 
                            style="font-size:12px; color:#000;">
                        </i>
                    </a>
                </th>
                <th scope="col">
                    Phone 
                    <a href="?sort=phone&order={{#if (and (eq currentSort 'phone') (eq currentOrder 'asc'))}}desc{{else}}asc{{/if}}">
                        <i class="bi {{#if (eq currentSort 'phone')}}{{#if (eq currentOrder 'asc')}}bi-caret-up-fill{{else}}bi-caret-down-fill{{/if}}{{else}}bi-chevron-expand{{/if}}" 
                            style="font-size:12px; color:#000;">
                        </i>
                    </a>
                </th>
                <th scope="col">
                    Address 
                    <a href="?sort=address&order={{#if (and (eq currentSort 'address') (eq currentOrder 'asc'))}}desc{{else}}asc{{/if}}">
                        <i class="bi {{#if (eq currentSort 'address')}}{{#if (eq currentOrder 'asc')}}bi-caret-up-fill{{else}}bi-caret-down-fill{{/if}}{{else}}bi-chevron-expand{{/if}}" 
                            style="font-size:12px; color:#000;">
                        </i>
                    </a>
                </th>
                <th scope="col" class="col_status">
                    Status <i class="bi bi-chevron-expand"></i>
                </th>
                <th scope="col" class="col_time">
                    Last Login 
                    <a href="?sort=lastLogin&order={{#if (and (eq currentSort 'lastLogin') (eq currentOrder 'asc'))}}desc{{else}}asc{{/if}}">
                        <i class="bi {{#if (eq currentSort 'lastLogin')}}{{#if (eq currentOrder 'asc')}}bi-caret-up-fill{{else}}bi-caret-down-fill{{/if}}{{else}}bi-chevron-expand{{/if}}" 
                            style="font-size:12px; color:#000;">
                        </i>
                    </a>
                </th>
            </tr>
        </thead>
        <tbody>
            {{#if searchType}}
                {{#each searchUser}}
                    <tr class="align-middle">
                        <td class="column_checkbox"><input type="checkbox" name="" id=""></th>
                        <td class="col-2 ps-5">
                            <div class="layout">
                                <div class="circle">
                                    <img src="{{this.avatar}}" alt="">
                                </div>
                                <span>{{this.name}}</span>
                            </div>
                        </td>
                        <td class="col-1">
                            <p>{{this.account}}</p>
                        </td>
                        <td class="col-2">
                            <p>{{this.email}}</p>
                        </td>
                        <td class="col-1">
                            <p>{{this.birthFormat}}</p>
                        </td><td class="col-1">
                            <p>{{this.phone}}</p>
                        </td>
                        <td class="col-2">
                            <p>{{this.address}}</p>
                        </td>
                        <td class="col_status col-1">
                            <div class="status_comment_approved status_comment is-center">
                                Active
                                <i class="bi bi-check2" ></i>
                            </div>
                        </td>
                        <td class="col_time col-2">
                            <p>{{this.lastLoginFormat}}</p>
                            <div class="layout is-center">
                                <div class="circle">
                                    <a href="/users/{{this._id}}/edit">
                                        <i class="bi bi-pencil-fill"></i>
                                    </a>
                                </div>
                                <div class="circle">
                                    <a href="/users/{{this._id}}/deleted" data-bs-toggle="modal" data-id="{{this._id}}" data-bs-target="#delete-user-model">
                                        <i class="bi bi-trash"></i>
                                    </a>
                                </div>
                                <div class="circle detail_btn" style="position: relative;overflow: unset;">
                                    <i class="bi bi-three-dots"></i>
                                    <div class="menu_model_user">
                                        <div class="view_user">
                                            <h5>View detail</h5>
                                        </div>
                                        <ul>
                                            <li>
                                                <a href="/users/cart/{{this._id}}">
                                                    <i class="bi bi-cart"></i>
                                                    Cart
                                                </a>
                                            </li>
                                            <li>
                                                <a href="/users/comment/{{this._id}}">
                                                    <i class="bi bi-chat-square-dots"></i>
                                                    Comments
                                                </a>
                                            </li>
                                            <li>
                                                <a href="/users/comment/{{this._id}}">
                                                    <i class="bi bi-box"></i>
                                                    Orders
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                {{/each}}
            {{else}}
                {{#each formatUser}}
                    <tr class="align-middle">
                        <td class="column_checkbox"><input type="checkbox" name="" id=""></th>
                        <td class="col-2 ps-5">
                            <div class="layout">
                                <div class="circle">
                                    <img src="{{this.avatar}}" alt="">
                                </div>
                                <span>{{this.name}}</span>
                            </div>
                        </td>
                        <td class="col-1">
                            <p>{{this.account}}</p>
                        </td>
                        <td class="col-2">
                            <p>{{this.email}}</p>
                        </td>
                        <td class="col-1">
                            <p>{{this.birthFormat}}</p>
                        </td><td class="col-1">
                            <p>{{this.phone}}</p>
                        </td>
                        <td class="col-2">
                            <p>{{this.address}}</p>
                        </td>
                        <td class="col_status col-1">
                            <div class="status_comment_approved status_comment is-center">
                                Active
                                <i class="bi bi-check2" ></i>
                            </div>
                        </td>
                        <td class="col_time col-2">
                            <p>{{this.lastLoginFormat}}</p>
                            <div class="layout is-center">
                                <div class="circle">
                                    <a href="/users/{{this._id}}/edit">
                                        <i class="bi bi-pencil-fill"></i>
                                    </a>
                                </div>
                                <div class="circle">
                                    <a href="/users/{{this._id}}/deleted" data-bs-toggle="modal" data-id="{{this._id}}" data-bs-target="#delete-user-model">
                                        <i class="bi bi-trash"></i>
                                    </a>
                                </div>
                                <div class="circle detail_btn" style="position: relative;overflow: unset;">
                                    <i class="bi bi-three-dots"></i>
                                    <div class="menu_model_user">
                                        <div class="view_user">
                                            <h5>View detail</h5>
                                        </div>
                                        <ul>
                                            <li>
                                                <a href="/users/cart/{{this._id}}">
                                                    <i class="bi bi-cart"></i>
                                                    Cart
                                                </a>
                                            </li>
                                            <li>
                                                <a href="/users/comment/{{this._id}}">
                                                    <i class="bi bi-chat-square-dots"></i>
                                                    Comments
                                                </a>
                                            </li>
                                            <li>
                                                <a href="/users/comment/{{this._id}}">
                                                    <i class="bi bi-box"></i>
                                                    Orders
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                {{/each}}
            {{/if}}
        </tbody>
    </table>
    <div class="page_bar is-center">
      {{#if (gt currentPage 1)}}
        <button class="next previous">
          <a href="?page={{subtract currentPage 1}}" style="color:#292828;">
              <i class="bi bi-chevron-left"></i>
              Previous
          </a>
        </button>
      {{/if}}
      {{#each (range 1 totalPage)}}
        {{#if (eq this ../currentPage)}}
          <button class="number_page active">
            <a href="?page={{this}}">{{this}}</a>
          </button>
        {{else}}
          <button class="number_page">
            <a style="color:#292828;" href="?page={{this}}">{{this}}</a>
          </button>
        {{/if}}
      {{/each}}
      {{#if (gt currentPage 1)}}
        <button class="next previous">
          <a href="?page={{add currentPage 1}}" style="color:#292828;">
              Next
              <i class="bi bi-chevron-right"></i>
          </a>
        </button>
      {{/if}}
    </div> 
</div>

<form method="POST" name="delete-user-form"></form>
<div class="modal fade" id="delete-user-model" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">Delete user</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body d-flex align-items-center">
        Are you want to delete this user!
        <i class="bi bi-emoji-frown-fill" style="font-size: 1.2rem; color: red; margin-left: 10px;"></i>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" id="btn-delete">Delete</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

<div class="footer">
    Thank you for creating with HuyHung | 2024 © 
</div>

<script>
  const deleteSong = document.getElementById('delete-user-model')
  const btnDelete = document.getElementById('btn-delete');
  const deleteForm = document.forms['delete-user-form'];

  var user;
  if (deleteSong) {
    deleteSong.addEventListener('show.bs.modal', event => {
      const button = event.relatedTarget
      user = button.getAttribute('data-id')
    })
  }
  if(btnDelete){
    btnDelete.addEventListener('click', () => {
      deleteForm.action = '/users/' + user + '?_method=DELETE';
      deleteForm.submit();
    })
  }
</script>